<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TikTok Downloader</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0b0f14;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.container {
  background: #111827;
  padding: 25px;
  border-radius: 14px;
  width: 100%;
  max-width: 420px;
}

h1 {
  text-align: center;
  margin-bottom: 15px;
}

input, select {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: none;
  outline: none;
  margin-bottom: 10px;
}

button {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: none;
  background: #2563eb;
  color: white;
  font-weight: bold;
  cursor: pointer;
}

button:disabled {
  opacity: 0.6;
}

#result {
  margin-top: 15px;
  font-size: 14px;
}

a.download {
  display: block;
  margin-top: 10px;
  padding: 10px;
  background: #16a34a;
  text-align: center;
  border-radius: 8px;
  color: white;
  text-decoration: none;
  font-weight: bold;
}
</style>
</head>

<body>

<div class="container">
  <h1>TikTok Downloader By Icall</h1>

  <div style="display:flex;gap:8px">
    <input id="url" placeholder="Paste link TikTok..." />
    <button onclick="pasteLink()" style="width:90px">Paste</button>
  </div>

  <select id="format">
    <option value="mp4">MP4 (No Watermark)</option>
    <option value="hd">MP4 HD</option>
    <option value="mp3">MP3 (Audio)</option>
  </select>

  <button onclick="download()">Download</button>

  <div id="result"></div>
</div>

<script>
const urlInput = document.getElementById("url");
const result = document.getElementById("result");
const button = document.querySelector("button");

urlInput.addEventListener("paste", () => {
  setTimeout(() => {
    if (urlInput.value.includes("tiktok.com")) download();
  }, 100);
});

async function pasteLink() {
  try {
    const text = await navigator.clipboard.readText();
    urlInput.value = text;
    if (text.includes("tiktok.com")) download();
  } catch {
    alert("Clipboard tidak diizinkan");
  }
}

async function download() {
  const url = urlInput.value.trim();
  const format = document.getElementById("format").value;

  if (!url) {
    result.innerHTML = "‚ùå Masukkan link TikTok";
    return;
  }

  button.disabled = true;
  result.innerHTML = "‚è≥ Mengambil data...";

  try {
    const res = await fetch("/api/tiktok", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ url, format })
    });

    const data = await res.json();

    if (!data.success) {
      result.innerHTML = "‚ùå Gagal mengambil video";
    } else if (data.format === "mp3") {
      result.innerHTML = `
        üéµ <b>${data.title}</b><br>
        üë§ ${data.author}
        <a class="download" href="${data.download}" target="_blank">
          ‚¨á Download MP3
        </a>
      `;
    } else {
      result.innerHTML = `
        <b>${data.title}</b><br>
        üë§ ${data.author}

        <video controls style="width:100%;margin-top:10px;border-radius:10px">
          <source src="${data.preview}" type="video/mp4">
        </video>

        <a class="download" href="${data.download}" target="_blank">
          ‚¨á Download Video
        </a>
      `;
    }
  } catch (e) {
    result.innerHTML = "‚ùå Server error";
  }

  button.disabled = false;
}
</script>

</body>
</html>